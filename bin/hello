#!/bin/zsh
# source ~/.bashrc

if [[ "${OSTYPE//[0-9.]/}" == 'darwin' ]]; then
    # Common
	open /Applications/Dropbox.app
	open /Applications/TogglDesktop.app
	open /Applications/Franz.app

    # Don't Forget
	cd ~/Dropbox/Code/python-dontforget
	docker-compose stop # telegram
#	docker-compose up -d

	if [[ "$1" == 'work' ]]; then
		open /Applications/Skype.app
		open /Applications/Slack.app
		open /Applications/iTunes.app
		open /Applications/Telegram.app
		open /Applications/PyCharm.app

		# https://docs.docker.com/installation/mac/
		echo 'Starting Docker VM'
		cd ~/eatfirst/cave
		docker-compose up -d
		exit
	fi

	if [[ "$1" == 'home' ]]; then
		echo 'Killing work apps'
		pkill Skype
		pkill Slack
		pkill iTunes

		echo 'Stopping Cave containers'
		cd ~/eatfirst/cave
		docker-compose stop
		exit
	fi

	echo 'Work or home?'
	exit
fi

echo "Hostname=$HOSTNAME"
echo "Work computer=$G_WORK_COMPUTER"
echo "Home computer=$G_HOME_COMPUTER"

echo 'TODO Review this script again for Linux'
exit

# Can't use "pidof gnome-do" because "gnome-do" is not the executable's name, so it doesn't have a PID
[ -z "$(ps aux | grep -v grep | grep gnome-do)" -a "$(type -p gnome-do)" ] && gnome-do &

[ -z "$(ps aux | grep -v grep | grep indicator-multiload)" -a "$(type -p indicator-multiload)" ] && indicator-multiload --trayicon &

[ -z "$(pidof imwheel)" -a "$(type -p imwheel)" ] && imwheel

[ -z "$(pidof rescuetime)" -a "$(type -p rescuetime)" ] && rescuetime &

monitors.sh

if [ "$HOSTNAME" = "$G_WORK_COMPUTER" ] ; then
	# First workspace
	wmctrl -s 0
	pidgin &
	subl &

	# Second workspace
	wmctrl -s 1

	thunderbird &
	rhythmbox &
	V_DOC_DIR='2work'
fi

if [ "$HOSTNAME" = "$G_HOME_COMPUTER" ] ; then
	V_DOC_DIR='2home'
fi

# Warn about files in the HOME directory
V_FIND="$(find $HOME -maxdepth 1 -type f -not -name '.*')"
if [ -n "$V_FIND" ] ; then
	echo "$V_FIND"
	zenity --warning --no-wrap --text="There are some files in the HOME directory:

$V_FIND" &
fi

# Show files in download dirs
V_OLD_IFS=$IFS
IFS='
'
V_FIND=$(find $HOME -maxdepth 4 -type d -not -empty -and \( -name 2both -or -name $V_DOC_DIR -or -wholename '*deluge*downloads' -or -wholename $G_BANK_STATEMENTS_DIR/buxfer/new -or -name Scanner \))
if [ -n "$V_FIND" ]; then
	for V_ONE_DIR in $V_FIND; do
		xdg-open $V_ONE_DIR
	done
fi
IFS=$V_OLD_IFS

# Show download folder if not empty (ignoring hidden files and dirs)
[ $(find $G_DOWNLOAD_DIR -type f -not -wholename '*/.*/*' | wc -l) -ne 0 ] && xdg-open $G_DOWNLOAD_DIR

if [ "$HOSTNAME" = "$G_WORK_COMPUTER" ] ; then
	dropbox-shutdown.sh
else
	for V_WINDOW_ID in $(wmctrl -lx | grep -i '\-terminal' | tr -s ' ' | cut -d ' ' -f 1) ; do
		# Move all terminal windows using their IDs
		wmctrl-set-position.sh 0 1400,100 $V_WINDOW_ID -i
	done

	dropbox start
fi

# Show the workspaces indicator when we're not in a XFCE session
if [ -z "$(pidof xfce4-session)" ] ; then
	V_SECONDS=10
	echo "Sleeping $V_SECONDS seconds..."
	sleep $V_SECONDS

	indicator-workspaces-restart.sh
fi

# I don't know why, but sometimes this script appears multiple times in the process list.
# So, allow me to kill myself.
pkill $(basename $0)
